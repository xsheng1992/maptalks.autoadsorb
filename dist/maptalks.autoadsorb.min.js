/*!
 * maptalks.autoadsorb v0.2.0
 * LICENSE : MIT
 * (c) 2016-2021 maptalks.org
 */
/*!
 * requires maptalks@>=0.47.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,s){"use strict";var oe="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}var u=e(function(t,e){t.exports=function(){"use strict";function t(t,e,r,n,o){y(t,e,r||0,n||t.length-1,o||i)}function y(t,e,r,n,o){while(n>r){if(n-r>600){var i=n-r+1;var a=e-r+1;var s=Math.log(i);var u=.5*Math.exp(2*s/3);var c=.5*Math.sqrt(s*u*(i-u)/i)*(a-i/2<0?-1:1);var l=Math.max(r,Math.floor(e-a*u/i+c));var f=Math.min(n,Math.floor(e+(i-a)*u/i+c));y(t,e,l,f,o)}var h=t[e];var p=r;var d=n;_(t,r,e);if(o(t[n],h)>0)_(t,r,n);while(p<d){_(t,p,d);p++;d--;while(o(t[p],h)<0)p++;while(o(t[d],h)>0)d--}if(o(t[r],h)===0)_(t,r,d);else{d++;_(t,d,n)}if(d<=e)r=d+1;if(e<=d)n=d-1}}function _(t,e,r){var n=t[e];t[e]=t[r];t[r]=n}function i(t,e){return t<e?-1:t>e?1:0}return t}()}),r=o,n=o;function o(t,e){if(!(this instanceof o))return new o(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function p(t,e){d(t,0,t.children.length,e,t)}function d(t,e,r,n,o){(o=o||_(null)).minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var i,a=e;a<r;a++)i=t.children[a],l(o,t.leaf?n(i):i);return o}function l(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function i(t,e){return t.minX-e.minX}function a(t,e){return t.minY-e.minY}function y(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function f(t){return t.maxX-t.minX+(t.maxY-t.minY)}function h(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function c(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function _(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(t,e,r,n,o){for(var i,a=[e,r];a.length;)(r=a.pop())-(e=a.pop())<=n||(i=e+Math.ceil((r-e)/n/2)*n,u(t,i,e,r,o),a.push(e,i,i,r))}o.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],n=this.toBBox;if(!c(t,e))return r;for(var o,i,a,s,u=[];e;){for(o=0,i=e.children.length;o<i;o++)a=e.children[o],c(t,s=e.leaf?n(a):a)&&(e.leaf?r.push(a):h(t,s)?this._all(a,r):u.push(a));e=u.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!c(t,e))return!1;for(var n,o,i,a,s=[];e;){for(n=0,o=e.children.length;n<o;n++)if(i=e.children[n],c(t,a=e.leaf?r(i):i)){if(e.leaf||h(t,a))return!0;s.push(i)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var n,o=this._build(t.slice(),0,t.length-1,0);return this.data.children.length?this.data.height===o.height?this._splitRoot(this.data,o):(this.data.height<o.height&&(n=this.data,this.data=o,o=n),this._insert(o,this.data.height-o.height-1,!0)):this.data=o,this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=_([]),this},remove:function(t,e){if(!t)return this;for(var r,n,o,i,a=this.data,s=this.toBBox(t),u=[],c=[];a||u.length;){if(a||(a=u.pop(),n=u[u.length-1],r=c.pop(),i=!0),a.leaf&&-1!==(o=function(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}(t,a.children,e)))return a.children.splice(o,1),u.push(a),this._condense(u),this;i||a.leaf||!h(a,s)?n?(r++,a=n.children[r],i=!1):a=null:(u.push(a),c.push(r),a=(n=a).children[r=0])}return this},toBBox:function(t){return t},compareMinX:i,compareMinY:a,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,n){var o,i=r-e+1,a=this._maxEntries;if(i<=a)return p(o=_(t.slice(e,r+1)),this.toBBox),o;n||(n=Math.ceil(Math.log(i)/Math.log(a)),a=Math.ceil(i/Math.pow(a,n-1))),(o=_([])).leaf=!1,o.height=n;var s,u,c,l,f=Math.ceil(i/a),h=f*Math.ceil(Math.sqrt(a));for(m(t,e,r,h,this.compareMinX),s=e;s<=r;s+=h)for(m(t,s,c=Math.min(s+h-1,r),f,this.compareMinY),u=s;u<=c;u+=f)l=Math.min(u+f-1,c),o.children.push(this._build(t,u,l,n-1));return p(o,this.toBBox),o},_chooseSubtree:function(t,e,r,n){for(var o,i,a,s,u,c,l,f,h;n.push(e),!e.leaf&&n.length-1!==r;){for(c=l=1/0,o=0,i=e.children.length;o<i;o++)u=y(a=e.children[o]),f=t,h=a,(f=(Math.max(h.maxX,f.maxX)-Math.min(h.minX,f.minX))*(Math.max(h.maxY,f.maxY)-Math.min(h.minY,f.minY))-u)<l?(l=f,c=u<c?u:c,s=a):f===l&&u<c&&(c=u,s=a);e=s||e.children[0]}return e},_insert:function(t,e,r){var n=this.toBBox,r=r?t:n(t),o=[],n=this._chooseSubtree(r,this.data,e,o);for(n.children.push(t),l(n,r);0<=e&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(r,o,e)},_split:function(t,e){var r=t[e],n=r.children.length,o=this._minEntries;this._chooseSplitAxis(r,o,n);n=this._chooseSplitIndex(r,o,n),n=_(r.children.splice(n,r.children.length-n));n.height=r.height,n.leaf=r.leaf,p(r,this.toBBox),p(n,this.toBBox),e?t[e-1].children.push(n):this._splitRoot(r,n)},_splitRoot:function(t,e){this.data=_([t,e]),this.data.height=t.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){for(var n,o,i,a,s,u,c,l,f,h=i=1/0,p=e;p<=r-e;p++)n=d(t,0,p,this.toBBox),o=d(t,p,r,this.toBBox),s=n,u=o,f=l=c=void 0,c=Math.max(s.minX,u.minX),l=Math.max(s.minY,u.minY),f=Math.min(s.maxX,u.maxX),u=Math.min(s.maxY,u.maxY),l=Math.max(0,f-c)*Math.max(0,u-l),o=y(n)+y(o),l<h?(h=l,a=p,i=o<i?o:i):l===h&&o<i&&(i=o,a=p);return a},_chooseSplitAxis:function(t,e,r){var n=t.leaf?this.compareMinX:i,o=t.leaf?this.compareMinY:a;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,o)&&t.children.sort(n)},_allDistMargin:function(t,e,r,n){t.children.sort(n);for(var o,i=this.toBBox,a=d(t,0,e,i),s=d(t,r-e,r,i),u=f(a)+f(s),c=e;c<r-e;c++)o=t.children[c],l(a,t.leaf?i(o):o),u+=f(a);for(c=r-e-1;e<=c;c--)o=t.children[c],l(s,t.leaf?i(o):o),u+=f(s);return u},_adjustParentBBoxes:function(t,e,r){for(var n=r;0<=n;n--)l(e[n],t)},_condense:function(t){for(var e,r=t.length-1;0<=r;r--)0===t[r].children.length?0<r?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():p(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}},r.default=n;var v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g=6371008.8,b={centimeters:100*g,centimetres:100*g,degrees:g/111325,feet:3.28084*g,inches:39.37*g,kilometers:g/1e3,kilometres:g/1e3,meters:g,metres:g,miles:g/1609.344,millimeters:1e3*g,millimetres:1e3*g,nauticalmiles:g/1852,radians:1,yards:g/1.0936},w={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function x(t,e,r){var n={type:"Feature"};return 0!==(r=void 0===r?{}:r).id&&!r.id||(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function j(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!F(t[0])||!F(t[1]))throw new Error("coordinates must contain numbers");return x({type:"Point",coordinates:t},e,r)}function S(t,e,r){void 0===r&&(r={});for(var n=0,o=t;n<o.length;n++){var i=o[n];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<i[i.length-1].length;a++)if(i[i.length-1][a]!==i[0][a])throw new Error("First and last Position are not equivalent.")}return x({type:"Polygon",coordinates:t},e,r)}function P(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return x({type:"LineString",coordinates:t},e,r)}function E(t,e){var r={type:"FeatureCollection"};return(e=void 0===e?{}:e).id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function M(t,e,r){return x({type:"MultiLineString",coordinates:t},e,r=void 0===r?{}:r)}function A(t,e,r){return x({type:"MultiPoint",coordinates:t},e,r=void 0===r?{}:r)}function O(t,e,r){return x({type:"MultiPolygon",coordinates:t},e,r=void 0===r?{}:r)}function C(t,e){var r=b[e=void 0===e?"kilometers":e];if(!r)throw new Error(e+" units is invalid");return t*r}function k(t,e){var r=b[e=void 0===e?"kilometers":e];if(!r)throw new Error(e+" units is invalid");return t/r}function L(t){return 180*(t%(2*Math.PI))/Math.PI}function F(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function G(t){return!!t&&t.constructor===Object}var T=Object.freeze({earthRadius:g,factors:b,unitsFactors:{centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/g,yards:1/1.0936},areaFactors:w,feature:x,geometry:function(t,e,r){switch(void 0===r&&(r={}),t){case"Point":return j(e).geometry;case"LineString":return P(e).geometry;case"Polygon":return S(e).geometry;case"MultiPoint":return A(e).geometry;case"MultiLineString":return M(e).geometry;case"MultiPolygon":return O(e).geometry;default:throw new Error(t+" is invalid")}},point:j,points:function(t,e,r){return void 0===r&&(r={}),E(t.map(function(t){return j(t,e)}),r)},polygon:S,polygons:function(t,e,r){return void 0===r&&(r={}),E(t.map(function(t){return S(t,e)}),r)},lineString:P,lineStrings:function(t,e,r){return void 0===r&&(r={}),E(t.map(function(t){return P(t,e)}),r)},featureCollection:E,multiLineString:M,multiPoint:A,multiPolygon:O,geometryCollection:function(t,e,r){return x({type:"GeometryCollection",geometries:t},e,r=void 0===r?{}:r)},round:function(t,e){if((e=void 0===e?0:e)&&!(0<=e))throw new Error("precision must be a positive number");return e=Math.pow(10,e||0),Math.round(t*e)/e},radiansToLength:C,lengthToRadians:k,lengthToDegrees:function(t,e){return L(k(t,e))},bearingToAzimuth:function(t){return(t%=360)<0&&(t+=360),t},radiansToDegrees:L,degreesToRadians:function(t){return t%360*Math.PI/180},convertLength:function(t,e,r){if(void 0===e&&(e="kilometers"),void 0===r&&(r="kilometers"),!(0<=t))throw new Error("length must be a positive number");return C(k(t,e),r)},convertArea:function(t,e,r){if(void 0===e&&(e="meters"),void 0===r&&(r="kilometers"),!(0<=t))throw new Error("area must be a positive number");if(!(e=w[e]))throw new Error("invalid original units");if(!(r=w[r]))throw new Error("invalid final units");return t/e*r},isNumber:F,isObject:G,validateBBox:function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(t){if(!F(t))throw new Error("bbox must only contain numbers")})},validateId:function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(void 0===t?"undefined":v(t)))throw new Error("id must be a number or a string")}});function B(t,e,r){if(null!==t)for(var n,o,i,a=0,s=t.type,u="FeatureCollection"===s,c="Feature"===s,l=u?t.features.length:1,f=0;f<l;f++)for(var h,p,d=(p=!!(h=u?t.features[f].geometry:c?t.geometry:t)&&"GeometryCollection"===h.type)?h.geometries.length:1,y=0;y<d;y++){var _,m=0,v=0;if(null!==(_=p?h.geometries[y]:h)){var g=_.coordinates,b=_.type,w=!r||"Polygon"!==b&&"MultiPolygon"!==b?0:1;switch(b){case null:break;case"Point":if(!1===e(g,a,f,m,v))return!1;a++,m++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(!1===e(g[n],a,f,m,v))return!1;a++,"MultiPoint"===b&&m++}"LineString"===b&&m++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(o=0;o<g[n].length-w;o++){if(!1===e(g[n][o],a,f,m,v))return!1;a++}"MultiLineString"===b&&m++,"Polygon"===b&&v++}"Polygon"===b&&m++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(o=v=0;o<g[n].length;o++){for(i=0;i<g[n][o].length-w;i++){if(!1===e(g[n][o][i],a,f,m,v))return!1;a++}v++}m++}break;case"GeometryCollection":for(n=0;n<_.geometries.length;n++)if(!1===B(_.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}function X(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length&&!1!==e(t.features[r].properties,r);r++);break;case"Feature":e(t.properties,0)}}function Y(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function I(t,e){for(var r,n,o,i,a,s,u,c,l,f=0,h="FeatureCollection"===t.type,p="Feature"===t.type,d=h?t.features.length:1,y=0;y<d;y++){for(a=h?t.features[y].geometry:p?t.geometry:t,u=h?t.features[y].properties:p?t.properties:{},c=h?t.features[y].bbox:p?t.bbox:void 0,l=h?t.features[y].id:p?t.id:void 0,i=(s=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,n=0;n<i;n++)if(null!==(o=s?a.geometries[n]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,f,u,c,l))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],f,u,c,l))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,f,u,c,l))return!1;f++}}function N(t,c){I(t,function(t,e,r,n,o){var i,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1===c(x(t,r,{bbox:n,id:o}),e,0)?!1:void 0}switch(a){case"MultiPoint":i="Point";break;case"MultiLineString":i="LineString";break;case"MultiPolygon":i="Polygon"}for(var s=0;s<t.coordinates.length;s++){var u=t.coordinates[s];if(!1===c(x({type:i,coordinates:u},r),e,s))return!1}})}function z(t,p){N(t,function(i,a,s){var u=0;if(i.geometry){var t=i.geometry.type;if("Point"!==t&&"MultiPoint"!==t){var c,l=0,f=0,h=0;return!1!==B(i,function(t,e,r,n,o){if(void 0===c||l<a||f<n||h<o)return c=t,l=a,f=n,h=o,void(u=0);n=P([c,t],i.properties);if(!1===p(n,a,s,o,u))return!1;u++,c=t})&&void 0}}})}function D(t,a){if(!t)throw new Error("geojson is required");N(t,function(t,e,r){if(null!==t.geometry){var n=t.geometry.type,o=t.geometry.coordinates;switch(n){case"LineString":if(!1===a(t,e,r,0,0))return!1;break;case"Polygon":for(var i=0;i<o.length;i++)if(!1===a(P(o[i],t.properties),e,r,i))return!1}}})}var $=Object.freeze({coordEach:B,coordReduce:function(t,i,a,e){var s=a;return B(t,function(t,e,r,n,o){s=0===e&&void 0===a?t:i(s,t,e,r,n,o)},e),s},propEach:X,propReduce:function(t,r,n){var o=n;return X(t,function(t,e){o=0===e&&void 0===n?t:r(o,t,e)}),o},featureEach:Y,featureReduce:function(t,r,n){var o=n;return Y(t,function(t,e){o=0===e&&void 0===n?t:r(o,t,e)}),o},coordAll:function(t){var e=[];return B(t,function(t){e.push(t)}),e},geomEach:I,geomReduce:function(t,i,a){var s=a;return I(t,function(t,e,r,n,o){s=0===e&&void 0===a?t:i(s,t,e,r,n,o)}),s},flattenEach:N,flattenReduce:function(t,n,o){var i=o;return N(t,function(t,e,r){i=0===e&&0===r&&void 0===o?t:n(i,t,e,r)}),i},segmentEach:z,segmentReduce:function(t,i,a){var s=a,u=!1;return z(t,function(t,e,r,n,o){s=!1===u&&void 0===a?t:i(s,t,e,r,n,o),u=!0}),s},lineEach:D,lineReduce:function(t,o,i){var a=i;return D(t,function(t,e,r,n){a=0===e&&void 0===i?t:o(a,t,e,r,n)}),a},findSegment:function(t,e){if(!G(e=e||{}))throw new Error("options is invalid");var r,n=e.featureIndex||0,o=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.segmentIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),s=s||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":s=s||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return P([u[a=a<0?u.length+a-1:a],u[a+1]],s,e);case"Polygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a-1),P([u[i][a],u[i][a+1]],s,e);case"MultiLineString":return o<0&&(o=u.length+o),a<0&&(a=u[o].length+a-1),P([u[o][a],u[o][a+1]],s,e);case"MultiPolygon":return o<0&&(o=u.length+o),i<0&&(i=u[o].length+i),a<0&&(a=u[o][i].length-a-1),P([u[o][i][a],u[o][i][a+1]],s,e)}throw new Error("geojson is invalid")},findPoint:function(t,e){if(!G(e=e||{}))throw new Error("options is invalid");var r,n=e.featureIndex||0,o=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.coordIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),s=s||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":s=s||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":return j(u,s,e);case"MultiPoint":return j(u[o=o<0?u.length+o:o],s,e);case"LineString":return j(u[a=a<0?u.length+a:a],s,e);case"Polygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a),j(u[i][a],s,e);case"MultiLineString":return o<0&&(o=u.length+o),a<0&&(a=u[o].length+a),j(u[o][a],s,e);case"MultiPolygon":return o<0&&(o=u.length+o),i<0&&(i=u[o].length+i),a<0&&(a=u[o][i].length-a),j(u[o][i][a],s,e)}throw new Error("geojson is invalid")}});function R(t){var e=[1/0,1/0,-1/0,-1/0];return B(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}R.default=R;var q=Object.freeze({default:R}),U=(q&&R).default,V=$.featureEach,J=T.featureCollection;function W(t){t=r(t);return t.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox||U(t),r.prototype.insert.call(this,t)},t.load=function(t){var e=[];return Array.isArray(t)?t.forEach(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox||U(t),e.push(t)}):V(t,function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox||U(t),e.push(t)}),r.prototype.load.call(this,e)},t.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox||U(t),r.prototype.remove.call(this,t,e)},t.clear=function(){return r.prototype.clear.call(this)},t.search=function(t){t=r.prototype.search.call(this,this.toBBox(t));return J(t)},t.collides=function(t){return r.prototype.collides.call(this,this.toBBox(t))},t.all=function(){var t=r.prototype.all.call(this);return J(t)},t.toJSON=function(){return r.prototype.toJSON.call(this)},t.fromJSON=function(t){return r.prototype.fromJSON.call(this,t)},t.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=U(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=U(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},t}var K=W;K.default=W;var It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H=e(function(t,e){var n="__lodash_hash_undefined__",v=1,y=2,h=9007199254740991,f="[object Arguments]",p="[object Array]",r="[object AsyncFunction]",d="[object Boolean]",_="[object Date]",m="[object Error]",o="[object Function]",i="[object GeneratorFunction]",g="[object Map]",b="[object Number]",a="[object Null]",w="[object Object]",s="[object Promise]",u="[object Proxy]",x="[object RegExp]",j="[object Set]",S="[object String]",P="[object Symbol]",c="[object Undefined]",l="[object WeakMap]",E="[object ArrayBuffer]",M="[object DataView]",A=/^\[object .+?Constructor\]$/,O=/^(?:0|[1-9]\d*)$/,C={};C["[object Float32Array]"]=C["[object Float64Array]"]=C["[object Int8Array]"]=C["[object Int16Array]"]=C["[object Int32Array]"]=C["[object Uint8Array]"]=C["[object Uint8ClampedArray]"]=C["[object Uint16Array]"]=C["[object Uint32Array]"]=!0,C[f]=C[p]=C[E]=C[d]=C[M]=C[_]=C[m]=C[o]=C[g]=C[b]=C[w]=C[x]=C[j]=C[S]=C[l]=!1;var k="object"==It(oe)&&oe&&oe.Object===Object&&oe,L="object"==("undefined"==typeof self?"undefined":It(self))&&self&&self.Object===Object&&self,F=k||L||Function("return this")(),G=e&&!e.nodeType&&e,T=G&&t&&!t.nodeType&&t,B=T&&T.exports===G,X=B&&k.process,L=function(){try{return X&&X.binding&&X.binding("util")}catch(t){}}(),e=L&&L.isTypedArray;function Y(t){var r=-1,n=Array(t.size);return t.forEach(function(t,e){n[++r]=[e,t]}),n}function I(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var N,z,T=Array.prototype,G=Function.prototype,D=Object.prototype,k=F["__core-js_shared__"],$=G.toString,R=D.hasOwnProperty,q=(L=/[^.]+$/.exec(k&&k.keys&&k.keys.IE_PROTO||""))?"Symbol(src)_1."+L:"",U=D.toString,V=RegExp("^"+$.call(R).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),G=B?F.Buffer:void 0,k=F.Symbol,J=F.Uint8Array,W=D.propertyIsEnumerable,K=T.splice,H=k?k.toStringTag:void 0,Q=Object.getOwnPropertySymbols,L=G?G.isBuffer:void 0,Z=(N=Object.keys,z=Object,function(t){return N(z(t))}),B=St(F,"DataView"),tt=St(F,"Map"),T=St(F,"Promise"),G=St(F,"Set"),F=St(F,"WeakMap"),et=St(Object,"create"),rt=Mt(B),nt=Mt(tt),ot=Mt(T),it=Mt(G),at=Mt(F),k=k?k.prototype:void 0,st=k?k.valueOf:void 0;function ut(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function ct(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function lt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function ft(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new lt;++e<r;)this.add(t[e])}function ht(t){t=this.__data__=new ct(t);this.size=t.size}function pt(t,e){var r,n,o,i=Ct(t),a=!i&&Ot(t),s=!i&&!a&&kt(t),u=!i&&!a&&!s&&Xt(t),c=i||a||s||u,l=c?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],f=l.length;for(r in t)!e&&!R.call(t,r)||c&&("length"==r||s&&("offset"==r||"parent"==r)||u&&("buffer"==r||"byteLength"==r||"byteOffset"==r)||(n=r,!!(o=null==(o=f)?h:o)&&("number"==typeof n||O.test(n))&&-1<n&&n%1==0&&n<o))||l.push(r);return l}function dt(t,e){for(var r=t.length;r--;)if(At(t[r][0],e))return r;return-1}function yt(t,e,r){e=e(t);return Ct(t)?e:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(e,r(t))}function _t(t){return null==t?void 0===t?c:a:H&&H in Object(t)?function(t){var e=R.call(t,H),r=t[H];try{var n=!(t[H]=void 0)}catch(t){}var o=U.call(t);n&&(e?t[H]=r:delete t[H]);return o}(t):(t=t,U.call(t))}function mt(t){return Tt(t)&&_t(t)==f}function vt(t,e,r,n,o){return t===e||(null==t||null==e||!Tt(t)&&!Tt(e)?t!=t&&e!=e:function(t,e,r,n,o,i){var a=Ct(t),s=Ct(e),u=a?p:Et(t),c=s?p:Et(e),l=(u=u==f?w:u)==w,s=(c=c==f?w:c)==w,c=u==c;if(c&&kt(t)){if(!kt(e))return!1;l=!(a=!0)}if(c&&!l)return i=i||new ht,a||Xt(t)?wt(t,e,r,n,o,i):function(t,e,r,n,o,i,a){switch(r){case M:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case E:return t.byteLength==e.byteLength&&i(new J(t),new J(e))?!0:!1;case d:case _:case b:return At(+t,+e);case m:return t.name==e.name&&t.message==e.message;case x:case S:return t==e+"";case g:var s=Y;case j:var u=n&v;if(s=s||I,t.size!=e.size&&!u)return!1;u=a.get(t);if(u)return u==e;n|=y,a.set(t,e);s=wt(s(t),s(e),n,o,i,a);return a.delete(t),s;case P:if(st)return st.call(t)==st.call(e)}return!1}(t,e,u,r,n,o,i);if(!(r&v)){l=l&&R.call(t,"__wrapped__"),s=s&&R.call(e,"__wrapped__");if(l||s){l=l?t.value():t,s=s?e.value():e;return i=i||new ht,o(l,s,r,n,i)}}return c&&(i=i||new ht,function(t,e,r,n,o,i){var a=r&v,s=xt(t),u=s.length,c=xt(e).length;if(u!=c&&!a)return!1;var l=u;for(;l--;){var f=s[l];if(!(a?f in e:R.call(e,f)))return!1}var h=i.get(t);if(h&&i.get(e))return h==e;var p=!0;i.set(t,e),i.set(e,t);var d=a;for(;++l<u;){f=s[l];var y,_=t[f],m=e[f];if(!(void 0===(y=n?a?n(m,_,f,e,t,i):n(_,m,f,t,e,i):y)?_===m||o(_,m,r,n,i):y)){p=!1;break}d=d||"constructor"==f}p&&!d&&(c=t.constructor,h=e.constructor,c!=h&&"constructor"in t&&"constructor"in e&&!("function"==typeof c&&c instanceof c&&"function"==typeof h&&h instanceof h)&&(p=!1));return i.delete(t),i.delete(e),p}(t,e,r,n,o,i))}(t,e,r,n,vt,o))}function gt(t){var e;return Gt(t)&&(e=t,!(q&&q in e))&&(Lt(t)?V:A).test(Mt(t))}function bt(t){if(r="function"==typeof(r=(e=t)&&e.constructor)&&r.prototype||D,e!==r)return Z(t);var e,r,n,o=[];for(n in Object(t))R.call(t,n)&&"constructor"!=n&&o.push(n);return o}function wt(t,e,n,o,i,a){var r=n&v,s=t.length,u=e.length;if(s!=u&&!(r&&s<u))return!1;u=a.get(t);if(u&&a.get(e))return u==e;var c=-1,l=!0,f=n&y?new ft:void 0;for(a.set(t,e),a.set(e,t);++c<s;){var h,p=t[c],d=e[c];if(void 0!==(h=o?r?o(d,p,c,e,t,a):o(p,d,c,t,e,a):h)){if(h)continue;l=!1;break}if(f){if(!function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return 1}(e,function(t,e){return r=e,!f.has(r)&&(p===t||i(p,t,n,o,a))&&f.push(e);var r})){l=!1;break}}else if(p!==d&&!i(p,d,n,o,a)){l=!1;break}}return a.delete(t),a.delete(e),l}function xt(t){return yt(t,Yt,Pt)}function jt(t,e){var r,n=t.__data__;return("string"==(t=void 0===(r=e)?"undefined":It(r))||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==r:null===r)?n["string"==typeof e?"string":"hash"]:n.map}function St(t,e){e=e,e=null==(t=t)?void 0:t[e];return gt(e)?e:void 0}ut.prototype.clear=function(){this.__data__=et?et(null):{},this.size=0},ut.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},ut.prototype.get=function(t){var e=this.__data__;if(et){var r=e[t];return r===n?void 0:r}return R.call(e,t)?e[t]:void 0},ut.prototype.has=function(t){var e=this.__data__;return et?void 0!==e[t]:R.call(e,t)},ut.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=et&&void 0===e?n:e,this},ct.prototype.clear=function(){this.__data__=[],this.size=0},ct.prototype.delete=function(t){var e=this.__data__;return!((t=dt(e,t))<0)&&(t==e.length-1?e.pop():K.call(e,t,1),--this.size,!0)},ct.prototype.get=function(t){var e=this.__data__;return(t=dt(e,t))<0?void 0:e[t][1]},ct.prototype.has=function(t){return-1<dt(this.__data__,t)},ct.prototype.set=function(t,e){var r=this.__data__,n=dt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this},lt.prototype.clear=function(){this.size=0,this.__data__={hash:new ut,map:new(tt||ct),string:new ut}},lt.prototype.delete=function(t){return t=jt(this,t).delete(t),this.size-=t?1:0,t},lt.prototype.get=function(t){return jt(this,t).get(t)},lt.prototype.has=function(t){return jt(this,t).has(t)},lt.prototype.set=function(t,e){var r=jt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},ft.prototype.add=ft.prototype.push=function(t){return this.__data__.set(t,n),this},ft.prototype.has=function(t){return this.__data__.has(t)},ht.prototype.clear=function(){this.__data__=new ct,this.size=0},ht.prototype.delete=function(t){var e=this.__data__,t=e.delete(t);return this.size=e.size,t},ht.prototype.get=function(t){return this.__data__.get(t)},ht.prototype.has=function(t){return this.__data__.has(t)},ht.prototype.set=function(t,e){var r=this.__data__;if(r instanceof ct){var n=r.__data__;if(!tt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new lt(n)}return r.set(t,e),this.size=r.size,this};var Pt=Q?function(e){return null==e?[]:(e=Object(e),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var a=t[r];e(a,r,t)&&(i[o++]=a)}return i}(Q(e),function(t){return W.call(e,t)}))}:function(){return[]},Et=_t;function Mt(t){if(null!=t){try{return $.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function At(t,e){return t===e||t!=t&&e!=e}(B&&Et(new B(new ArrayBuffer(1)))!=M||tt&&Et(new tt)!=g||T&&Et(T.resolve())!=s||G&&Et(new G)!=j||F&&Et(new F)!=l)&&(Et=function(t){var e=_t(t),t=e==w?t.constructor:void 0,t=t?Mt(t):"";if(t)switch(t){case rt:return M;case nt:return g;case ot:return s;case it:return j;case at:return l}return e});var Ot=mt(function(){return arguments}())?mt:function(t){return Tt(t)&&R.call(t,"callee")&&!W.call(t,"callee")},Ct=Array.isArray;var kt=L||function(){return!1};function Lt(t){if(Gt(t)){t=_t(t);return t==o||t==i||t==r||t==u}}function Ft(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=h}function Gt(t){var e=void 0===t?"undefined":It(t);return null!=t&&("object"==e||"function"==e)}function Tt(t){return null!=t&&"object"==(void 0===t?"undefined":It(t))}var Bt,Xt=e?(Bt=e,function(t){return Bt(t)}):function(t){return Tt(t)&&Ft(t.length)&&!!C[_t(t)]};function Yt(t){return(null!=(e=t)&&Ft(e.length)&&!Lt(e)?pt:bt)(t);var e}t.exports=function(t,e){return vt(t,e)}}),Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z="__lodash_hash_undefined__",tt=9007199254740991,et="[object Arguments]",rt="[object Function]",nt="[object GeneratorFunction]",ot=/^\[object .+?Constructor\]$/,n="object"==Q(oe)&&oe&&oe.Object===Object&&oe,g="object"==("undefined"==typeof self?"undefined":Q(self))&&self&&self.Object===Object&&self,q=n||g||Function("return this")();function it(t,e){return!!(t?t.length:0)&&-1<function(t,e,r){if(e!=e)return function(t,e,r,n){var o=t.length,i=r+(n?1:-1);for(;n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}(t,st,r);var n=r-1,o=t.length;for(;++n<o;)if(t[n]===e)return n;return-1}(t,e,0)}function at(t,e,r){for(var n=-1,o=t?t.length:0;++n<o;)if(r(e,t[n]))return!0;return!1}function st(t){return t!=t}function ut(t,e){return t.has(e)}var $=Array.prototype,T=Function.prototype,n=Object.prototype,g=q["__core-js_shared__"],ct=(g=/[^.]+$/.exec(g&&g.keys&&g.keys.IE_PROTO||""))?"Symbol(src)_1."+g:"",lt=T.toString,ft=n.hasOwnProperty,ht=n.toString,pt=RegExp("^"+lt.call(ft).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),T=q.Symbol,dt=n.propertyIsEnumerable,yt=$.splice,_t=T?T.isConcatSpreadable:void 0,mt=Math.max,vt=Ot(q,"Map"),gt=Ot(Object,"create");function bt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function wt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function xt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function jt(t){var e=-1,r=t?t.length:0;for(this.__data__=new xt;++e<r;)this.add(t[e])}function St(t,e){for(var r,n,o=t.length;o--;)if((r=t[o][0])===(n=e)||r!=r&&n!=n)return o;return-1}function Pt(t,e,r,n){var o,i=-1,a=it,s=!0,u=t.length,c=[],l=e.length;if(!u)return c;r&&(e=function(t,e){for(var r=-1,n=t?t.length:0,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(e,(o=r,function(t){return o(t)}))),n?(a=at,s=!1):200<=e.length&&(a=ut,s=!1,e=new jt(e));t:for(;++i<u;){var f=t[i],h=r?r(f):f,f=n||0!==f?f:0;if(s&&h==h){for(var p=l;p--;)if(e[p]===h)continue t;c.push(f)}else a(e,h,n)||c.push(f)}return c}function Et(t,e,r,n,o){var i=-1,a=t.length;for(r=r||Ct,o=o||[];++i<a;){var s=t[i];0<e&&r(s)?1<e?Et(s,e-1,r,n,o):function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r]}(o,s):n||(o[o.length]=s)}return o}function Mt(t){var e;return Xt(t)&&(e=t,!(ct&&ct in e))&&(Bt(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?pt:ot).test(function(t){if(null!=t){try{return lt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function At(t,e){var r,n=t.__data__;return("string"==(t=void 0===(r=e)?"undefined":Q(r))||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==r:null===r)?n["string"==typeof e?"string":"hash"]:n.map}function Ot(t,e){e=e,e=null==(t=t)?void 0:t[e];return Mt(e)?e:void 0}function Ct(t){return Ft(t)||Tt(e=t)&&ft.call(e,"callee")&&(!dt.call(e,"callee")||ht.call(e)==et)||!!(_t&&t&&t[_t]);var e}bt.prototype.clear=function(){this.__data__=gt?gt(null):{}},bt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},bt.prototype.get=function(t){var e=this.__data__;if(gt){var r=e[t];return r===Z?void 0:r}return ft.call(e,t)?e[t]:void 0},bt.prototype.has=function(t){var e=this.__data__;return gt?void 0!==e[t]:ft.call(e,t)},bt.prototype.set=function(t,e){return this.__data__[t]=gt&&void 0===e?Z:e,this},wt.prototype.clear=function(){this.__data__=[]},wt.prototype.delete=function(t){var e=this.__data__;return!((t=St(e,t))<0)&&(t==e.length-1?e.pop():yt.call(e,t,1),!0)},wt.prototype.get=function(t){var e=this.__data__;return(t=St(e,t))<0?void 0:e[t][1]},wt.prototype.has=function(t){return-1<St(this.__data__,t)},wt.prototype.set=function(t,e){var r=this.__data__,n=St(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},xt.prototype.clear=function(){this.__data__={hash:new bt,map:new(vt||wt),string:new bt}},xt.prototype.delete=function(t){return At(this,t).delete(t)},xt.prototype.get=function(t){return At(this,t).get(t)},xt.prototype.has=function(t){return At(this,t).has(t)},xt.prototype.set=function(t,e){return At(this,t).set(t,e),this},jt.prototype.add=jt.prototype.push=function(t){return this.__data__.set(t,Z),this},jt.prototype.has=function(t){return this.__data__.has(t)};var kt,Lt,T=(kt=function(t,e){var r,n,n=(n=(r=e)?r.length:0)?r[n-1]:void 0;return Tt(n)&&(n=void 0),Tt(t)?Pt(t,Et(e,1,Tt,!0),void 0,n):[]},Lt=mt(void 0===Lt?kt.length-1:Lt,0),function(){for(var t=arguments,e=-1,r=mt(t.length-Lt,0),n=Array(r);++e<r;)n[e]=t[Lt+e];for(var e=-1,o=Array(Lt+1);++e<Lt;)o[e]=t[e];return o[Lt]=n,function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(kt,this,o)});var Ft=Array.isArray;function Gt(t){return null!=t&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=tt)&&!Bt(t);var e}function Tt(t){return!!(e=t)&&"object"==(void 0===e?"undefined":Q(e))&&Gt(t);var e}function Bt(t){t=Xt(t)?ht.call(t):"";return t==rt||t==nt}function Xt(t){var e=void 0===t?"undefined":Q(t);return t&&("object"==e||"function"==e)}var Yt=T,ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nt=e(function(t,e){var r="Expected a function",n="__lodash_hash_undefined__",y=1,v=2,i=1/0,o=9007199254740991,a=17976931348623157e292,s=NaN,f="[object Arguments]",h="[object Array]",p="[object Boolean]",d="[object Date]",_="[object Error]",u="[object Function]",c="[object GeneratorFunction]",m="[object Map]",g="[object Number]",b="[object Object]",l="[object Promise]",w="[object RegExp]",x="[object Set]",j="[object String]",S="[object Symbol]",P="[object WeakMap]",E="[object ArrayBuffer]",M="[object DataView]",A=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,O=/^\w*$/,C=/^\./,k=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,L=/^\s+|\s+$/g,F=/\\(\\)?/g,G=/^[-+]0x[0-9a-f]+$/i,T=/^0b[01]+$/i,B=/^\[object .+?Constructor\]$/,X=/^0o[0-7]+$/i,Y=/^(?:0|[1-9]\d*)$/,I={};I["[object Float32Array]"]=I["[object Float64Array]"]=I["[object Int8Array]"]=I["[object Int16Array]"]=I["[object Int32Array]"]=I["[object Uint8Array]"]=I["[object Uint8ClampedArray]"]=I["[object Uint16Array]"]=I["[object Uint32Array]"]=!0,I[f]=I[h]=I[E]=I[p]=I[M]=I[d]=I[_]=I[u]=I[m]=I[g]=I[b]=I[w]=I[x]=I[j]=I[P]=!1;var N=parseInt,z="object"==ie(oe)&&oe&&oe.Object===Object&&oe,D="object"==("undefined"==typeof self?"undefined":ie(self))&&self&&self.Object===Object&&self,$=z||D||Function("return this")(),R=e&&!e.nodeType&&e,q=R&&t&&!t.nodeType&&t,U=q&&q.exports===R&&z.process,D=function(){try{return U&&U.binding("util")}catch(t){}}(),e=D&&D.isTypedArray;function V(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function J(t){var r=-1,n=Array(t.size);return t.forEach(function(t,e){n[++r]=[e,t]}),n}function W(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var K,H,q=Array.prototype,R=Function.prototype,Q=Object.prototype,z=$["__core-js_shared__"],Z=(D=/[^.]+$/.exec(z&&z.keys&&z.keys.IE_PROTO||""))?"Symbol(src)_1."+D:"",tt=R.toString,et=Q.hasOwnProperty,rt=Q.toString,nt=RegExp("^"+tt.call(et).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),z=$.Symbol,ot=$.Uint8Array,it=Q.propertyIsEnumerable,at=q.splice,st=(K=Object.keys,H=Object,function(t){return K(H(t))}),ut=Math.max,D=Gt($,"DataView"),ct=Gt($,"Map"),R=Gt($,"Promise"),q=Gt($,"Set"),$=Gt($,"WeakMap"),lt=Gt(Object,"create"),ft=Dt(D),ht=Dt(ct),pt=Dt(R),dt=Dt(q),yt=Dt($),z=z?z.prototype:void 0,_t=z?z.valueOf:void 0,mt=z?z.toString:void 0;function vt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function gt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function bt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function wt(t){var e=-1,r=t?t.length:0;for(this.__data__=new bt;++e<r;)this.add(t[e])}function xt(t){this.__data__=new gt(t)}function jt(t,e){var r,n=Ut(t)||qt(t)?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],o=n.length,i=!!o;for(r in t)!e&&!et.call(t,r)||i&&("length"==r||Bt(r,o))||n.push(r);return n}function St(t,e){for(var r=t.length;r--;)if(Rt(t[r][0],e))return r;return-1}function Pt(t,e){for(var r=0,n=(e=Xt(e,t)?[e]:kt(e)).length;null!=t&&r<n;)t=t[zt(e[r++])];return r&&r==n?t:void 0}function Et(t,e){return null!=t&&e in Object(t)}function Mt(t,e,r,n,o){return t===e||(null==t||null==e||!Kt(t)&&!Ht(e)?t!=t&&e!=e:function(t,e,r,n,o,i){var a=Ut(t),s=Ut(e),u=h,c=h;a||(u=(u=Tt(t))==f?b:u);s||(c=(c=Tt(e))==f?b:c);var l=u==b&&!V(t),s=c==b&&!V(e),c=u==c;if(c&&!l)return i=i||new xt,a||te(t)?Lt(t,e,r,n,o,i):function(t,e,r,n,o,i,a){switch(r){case M:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case E:return t.byteLength==e.byteLength&&n(new ot(t),new ot(e))?!0:!1;case p:case d:case g:return Rt(+t,+e);case _:return t.name==e.name&&t.message==e.message;case w:case j:return t==e+"";case m:var s=J;case x:var u=i&v;if(s=s||W,t.size!=e.size&&!u)return!1;u=a.get(t);if(u)return u==e;i|=y,a.set(t,e);s=Lt(s(t),s(e),n,o,i,a);return a.delete(t),s;case S:if(_t)return _t.call(t)==_t.call(e)}return!1}(t,e,u,r,n,o,i);if(!(o&v)){l=l&&et.call(t,"__wrapped__"),s=s&&et.call(e,"__wrapped__");if(l||s){l=l?t.value():t,s=s?e.value():e;return i=i||new xt,r(l,s,n,o,i)}}return c&&(i=i||new xt,function(t,e,r,n,o,i){var a=o&v,s=re(t),u=s.length,c=re(e).length;if(u!=c&&!a)return!1;var l=u;for(;l--;){var f=s[l];if(!(a?f in e:et.call(e,f)))return!1}var h=i.get(t);if(h&&i.get(e))return h==e;var p=!0;i.set(t,e),i.set(e,t);var d=a;for(;++l<u;){f=s[l];var y,_=t[f],m=e[f];if(!(void 0===(y=n?a?n(m,_,f,e,t,i):n(_,m,f,t,e,i):y)?_===m||r(_,m,n,o,i):y)){p=!1;break}d=d||"constructor"==f}p&&!d&&(c=t.constructor,h=e.constructor,c!=h&&"constructor"in t&&"constructor"in e&&!("function"==typeof c&&c instanceof c&&"function"==typeof h&&h instanceof h)&&(p=!1));return i.delete(t),i.delete(e),p}(t,e,r,n,o,i))}(t,e,Mt,r,n,o))}function At(t){var e;return Kt(t)&&(e=t,!(Z&&Z in e))&&(Jt(t)||V(t)?nt:B).test(Dt(t))}function Ot(t){return"function"==typeof t?t:null==t?ne:"object"==(void 0===t?"undefined":ie(t))?Ut(t)?function(n,o){if(Xt(n)&&Yt(o))return It(zt(n),o);return function(t){var e,r=function(t,e,r){e=null==t?void 0:Pt(t,e);return void 0===e?r:e}(t,n);return void 0===r&&r===o?(e=n,null!=(t=t)&&function(t,e,r){e=Xt(e,t)?[e]:kt(e);var n,o=-1,i=e.length;for(;++o<i;){var a=zt(e[o]);if(!(n=null!=t&&r(t,a)))break;t=t[a]}if(n)return n;return!!(i=t?t.length:0)&&Wt(i)&&Bt(a,i)&&(Ut(t)||qt(t))}(t,e,Et)):Mt(o,r,void 0,y|v)}}(t[0],t[1]):function(e){var r=function(t){var e=re(t),r=e.length;for(;r--;){var n=e[r],o=t[n];e[r]=[n,o,Yt(o)]}return e}(e);if(1==r.length&&r[0][2])return It(r[0][0],r[0][1]);return function(t){return t===e||function(t,e,r,n){var o=r.length,i=o,a=!n;if(null==t)return!i;for(t=Object(t);o--;){var s=r[o];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++o<i;){var u=(s=r[o])[0],c=t[u],l=s[1];if(a&&s[2]){if(void 0===c&&!(u in t))return!1}else{var f,h=new xt;if(!(void 0===(f=n?n(c,l,u,t,e,h):f)?Mt(l,c,n,y|v,h):f))return!1}}return!0}(t,e,r)}}(t):Xt(t=t)?function(e){return function(t){return null==t?void 0:t[e]}}(zt(t)):function(e){return function(t){return Pt(t,e)}}(t)}function Ct(t){if(r="function"==typeof(r=(e=t)&&e.constructor)&&r.prototype||Q,e!==r)return st(t);var e,r,n,o=[];for(n in Object(t))et.call(t,n)&&"constructor"!=n&&o.push(n);return o}function kt(t){return Ut(t)?t:Nt(t)}function Lt(t,e,r,n,o,i){var a=o&v,s=t.length,u=e.length;if(s!=u&&!(a&&s<u))return!1;u=i.get(t);if(u&&i.get(e))return u==e;var c=-1,l=!0,f=o&y?new wt:void 0;for(i.set(t,e),i.set(e,t);++c<s;){var h,p=t[c],d=e[c];if(void 0!==(h=n?a?n(d,p,c,e,t,i):n(p,d,c,t,e,i):h)){if(h)continue;l=!1;break}if(f){if(!function(t,e){for(var r=-1,n=t?t.length:0;++r<n;)if(e(t[r],r,t))return 1}(e,function(t,e){return!f.has(e)&&(p===t||r(p,t,n,o,i))&&f.add(e)})){l=!1;break}}else if(p!==d&&!r(p,d,n,o,i)){l=!1;break}}return i.delete(t),i.delete(e),l}function Ft(t,e){var r,n=t.__data__;return("string"==(t=void 0===(r=e)?"undefined":ie(r))||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==r:null===r)?n["string"==typeof e?"string":"hash"]:n.map}function Gt(t,e){e=e,e=null==(t=t)?void 0:t[e];return At(e)?e:void 0}vt.prototype.clear=function(){this.__data__=lt?lt(null):{}},vt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},vt.prototype.get=function(t){var e=this.__data__;if(lt){var r=e[t];return r===n?void 0:r}return et.call(e,t)?e[t]:void 0},vt.prototype.has=function(t){var e=this.__data__;return lt?void 0!==e[t]:et.call(e,t)},vt.prototype.set=function(t,e){return this.__data__[t]=lt&&void 0===e?n:e,this},gt.prototype.clear=function(){this.__data__=[]},gt.prototype.delete=function(t){var e=this.__data__;return!((t=St(e,t))<0)&&(t==e.length-1?e.pop():at.call(e,t,1),!0)},gt.prototype.get=function(t){var e=this.__data__;return(t=St(e,t))<0?void 0:e[t][1]},gt.prototype.has=function(t){return-1<St(this.__data__,t)},gt.prototype.set=function(t,e){var r=this.__data__,n=St(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},bt.prototype.clear=function(){this.__data__={hash:new vt,map:new(ct||gt),string:new vt}},bt.prototype.delete=function(t){return Ft(this,t).delete(t)},bt.prototype.get=function(t){return Ft(this,t).get(t)},bt.prototype.has=function(t){return Ft(this,t).has(t)},bt.prototype.set=function(t,e){return Ft(this,t).set(t,e),this},wt.prototype.add=wt.prototype.push=function(t){return this.__data__.set(t,n),this},wt.prototype.has=function(t){return this.__data__.has(t)},xt.prototype.clear=function(){this.__data__=new gt},xt.prototype.delete=function(t){return this.__data__.delete(t)},xt.prototype.get=function(t){return this.__data__.get(t)},xt.prototype.has=function(t){return this.__data__.has(t)},xt.prototype.set=function(t,e){var r=this.__data__;if(r instanceof gt){var n=r.__data__;if(!ct||n.length<199)return n.push([t,e]),this;r=this.__data__=new bt(n)}return r.set(t,e),this};var Tt=function(t){return rt.call(t)};function Bt(t,e){return!!(e=null==e?o:e)&&("number"==typeof t||Y.test(t))&&-1<t&&t%1==0&&t<e}function Xt(t,e){if(!Ut(t)){var r=void 0===t?"undefined":ie(t);return"number"==r||"symbol"==r||"boolean"==r||null==t||Qt(t)||(O.test(t)||!A.test(t)||null!=e&&t in Object(e))}}function Yt(t){return t==t&&!Kt(t)}function It(e,r){return function(t){return null!=t&&(t[e]===r&&(void 0!==r||e in Object(t)))}}(D&&Tt(new D(new ArrayBuffer(1)))!=M||ct&&Tt(new ct)!=m||R&&Tt(R.resolve())!=l||q&&Tt(new q)!=x||$&&Tt(new $)!=P)&&(Tt=function(t){var e=rt.call(t),t=e==b?t.constructor:void 0,t=t?Dt(t):void 0;if(t)switch(t){case ft:return M;case ht:return m;case pt:return l;case dt:return x;case yt:return P}return e});var Nt=$t(function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(Qt(t))return mt?mt.call(t):"";var e=t+"";return"0"==e&&1/t==-i?"-0":e}(e);var o=[];return C.test(t)&&o.push(""),t.replace(k,function(t,e,r,n){o.push(r?n.replace(F,"$1"):e||t)}),o});function zt(t){if("string"==typeof t||Qt(t))return t;var e=t+"";return"0"==e&&1/t==-i?"-0":e}function Dt(t){if(null!=t){try{return tt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function $t(n,o){if("function"!=typeof n||o&&"function"!=typeof o)throw new TypeError(r);function i(){var t=arguments,e=o?o.apply(this,t):t[0],r=i.cache;return r.has(e)?r.get(e):(t=n.apply(this,t),i.cache=r.set(e,t),t)}return i.cache=new($t.Cache||bt),i}function Rt(t,e){return t===e||t!=t&&e!=e}function qt(t){return Ht(e=t)&&Vt(e)&&et.call(t,"callee")&&(!it.call(t,"callee")||rt.call(t)==f);var e}$t.Cache=bt;var Ut=Array.isArray;function Vt(t){return null!=t&&Wt(t.length)&&!Jt(t)}function Jt(t){t=Kt(t)?rt.call(t):"";return t==u||t==c}function Wt(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=o}function Kt(t){var e=void 0===t?"undefined":ie(t);return t&&("object"==e||"function"==e)}function Ht(t){return!!t&&"object"==(void 0===t?"undefined":ie(t))}function Qt(t){return"symbol"==(void 0===t?"undefined":ie(t))||Ht(t)&&rt.call(t)==S}var Zt,te=e?(Zt=e,function(t){return Zt(t)}):function(t){return Ht(t)&&Wt(t.length)&&!!I[rt.call(t)]};function ee(t){if("number"==typeof t)return t;if(Qt(t))return s;if("string"!=typeof(t=Kt(t)?Kt(e="function"==typeof t.valueOf?t.valueOf():t)?e+"":e:t))return 0===t?t:+t;t=t.replace(L,"");var e=T.test(t);return e||X.test(t)?N(t.slice(2),e?2:8):G.test(t)?s:+t}function re(t){return(Vt(t)?jt:Ct)(t)}function ne(t){return t}t.exports=function(t,e,r){var n=t?t.length:0;if(!n)return-1;var o=null==r?0:(r=(o=function(t){return t?(t=ee(t))!==i&&t!==-i?t==t?t:0:(t<0?-1:1)*a:0===t?t:0}(r=r))%1,o==o?r?o-r:o:0);return o<0&&(o=ut(n+o,0)),function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}(t,Ot(e),o)}}),zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dt=1/0,$t=9007199254740991,Rt=17976931348623157e292,qt=NaN,Ut="[object Arguments]",Vt="[object Function]",Jt="[object GeneratorFunction]",Wt="[object String]",Kt="[object Symbol]",Ht=/^\s+|\s+$/g,Qt=/^[-+]0x[0-9a-f]+$/i,Zt=/^0b[01]+$/i,te=/^0o[0-7]+$/i,ee=/^(?:0|[1-9]\d*)$/,re=parseInt;function ne(t,e,r){if(e!=e)return function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}(t,ae,r);for(var n=r-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1}function ae(t){return t!=t}function se(e,t){return function(t,e){for(var r=-1,n=t?t.length:0,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(t,function(t){return e[t]})}var ue,ce,le=Object.prototype,fe=le.hasOwnProperty,he=le.toString,pe=le.propertyIsEnumerable,de=(ue=Object.keys,ce=Object,function(t){return ue(ce(t))}),ye=Math.max;function _e(t,e){var r,n,o,i,a=ve(t)||function(t){return we(t)&&ge(t)}(r=t)&&fe.call(r,"callee")&&(!pe.call(r,"callee")||he.call(r)==Ut)?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],s=a.length,u=!!s;for(n in t)!e&&!fe.call(t,n)||u&&("length"==n||(o=n,!!(i=null==(i=s)?$t:i)&&("number"==typeof o||ee.test(o))&&-1<o&&o%1==0&&o<i))||a.push(n);return a}function me(t){if(r="function"==typeof(r=(e=t)&&e.constructor)&&r.prototype||le,e!==r)return de(t);var e,r,n,o=[];for(n in Object(t))fe.call(t,n)&&"constructor"!=n&&o.push(n);return o}var ve=Array.isArray;function ge(t){return null!=t&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=$t)&&!function(t){t=be(t)?he.call(t):"";return t==Vt||t==Jt}(t);var e}function be(t){var e=void 0===t?"undefined":zt(t);return t&&("object"==e||"function"==e)}function we(t){return!!t&&"object"==(void 0===t?"undefined":zt(t))}function xe(t){if("number"==typeof t)return t;if("symbol"==(void 0===(e=t)?"undefined":zt(e))||we(e)&&he.call(e)==Kt)return qt;var e;if("string"!=typeof(t=be(t)?be(r="function"==typeof t.valueOf?t.valueOf():t)?r+"":r:t))return 0===t?t:+t;t=t.replace(Ht,"");var r=Zt.test(t);return r||te.test(t)?re(t.slice(2),r?2:8):Qt.test(t)?qt:+t}var je=function(t,e,r,n){var o;t=ge(t)?t:(o=t)?se(o,function(t){return(ge(t)?_e:me)(t)}(o)):[],r=r&&!n?(a=(i=function(t){return t?(t=xe(t))!==Dt&&t!==-Dt?t==t?t:0:(t<0?-1:1)*Rt:0===t?t:0}(a=r))%1,i==i?a?i-a:i:0):0;var i,a=t.length;return r<0&&(r=ye(a+r,0)),"string"==typeof(i=t)||!ve(i)&&we(i)&&he.call(i)==Wt?r<=a&&-1<t.indexOf(e,r):!!a&&-1<ne(t,e,r)},Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pe=9007199254740991,Ee="[object Arguments]",Me="[object Function]",Ae="[object GeneratorFunction]",q="object"==Se(oe)&&oe&&oe.Object===Object&&oe,T="object"==("undefined"==typeof self?"undefined":Se(self))&&self&&self.Object===Object&&self,q=q||T||Function("return this")();var T=Object.prototype,Oe=T.hasOwnProperty,Ce=T.toString,q=q.Symbol,ke=T.propertyIsEnumerable,Le=q?q.isConcatSpreadable:void 0;function Fe(t,e,r,n,o){var i=-1,a=t.length;for(r=r||Ge,o=o||[];++i<a;){var s=t[i];0<e&&r(s)?1<e?Fe(s,e-1,r,n,o):function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r]}(o,s):n||(o[o.length]=s)}return o}function Ge(t){return Te(t)||function(t){return function(t){return!!t&&"object"==(void 0===t?"undefined":Se(t))}(t)&&function(t){return null!=t&&function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=Pe}(t.length)&&!function(t){t=function(t){var e=void 0===t?"undefined":Se(t);return!!t&&("object"==e||"function"==e)}(t)?Ce.call(t):"";return t==Me||t==Ae}(t)}(t)}(e=t)&&Oe.call(e,"callee")&&(!ke.call(e,"callee")||Ce.call(e)==Ee)||!!(Le&&t&&t[Le]);var e}var Te=Array.isArray;var Be=function(t){return(t?t.length:0)?Fe(t,1/0):[]};function Xe(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(e,o);i&&i.configurable&&void 0===t[o]&&Object.defineProperty(t,o,i)}}(t,e))}var Ye,Ie={mode:"auto",distance:10,needCtrl:!1},q=(Xe(Ne,Ye=s.Class),Ne.prototype.setLayer=function(t){var e,r=this;return t instanceof s.VectorLayer&&(e=t.map,this._addTo(e),this.adsorblayer=t,this.adsorblayer.on("addgeo",function(){return r._updateGeosSet()},this),this.adsorblayer.on("clear",function(){return r._resetGeosSet()},this),this.bindDrawTool(e._map_tool)),this},Ne.prototype.bindDrawTool=function(t){return t instanceof s.DrawTool&&((this.drawTool=t).on("enable",this.enable,this),t.on("disable",this.disable,this),t.on("remove",this.remove,this),t.isEnabled()&&this.enable()),this},Ne.prototype.setGeometry=function(t){var e,r;return t instanceof s.Geometry&&((r=(e=t._layer).map)._map_tool&&r._map_tool instanceof s.DrawTool&&r._map_tool.disable(),this._addTo(r),this.adsorblayer=e,this.bindGeometry(t)),this},Ne.prototype.bindGeometry=function(t){if(t instanceof s.Geometry){if(this.geometry)return this.setGeometry(t);this.geometry=t,this.geometryCoords=t.getCoordinates(),t.on("editstart",this.enable,this),t.on("editend",this.disable,this),t.on("remove",this.remove,this),t.isEditing()?(t.endEdit(),this.enable(),t.startEdit()):t.startEdit().endEdit()}return this},Ne.prototype.enable=function(){return this._isEnable=!0,this._updateGeosSet(),this._registerMapEvents(),this.drawTool&&this._registerDrawToolEvents(),this.geometry&&this._registerGeometryEvents(),this._mousemoveLayer&&this._mousemoveLayer.show(),this},Ne.prototype.disable=function(){return this._isEnable=!1,this._offMapEvents(),this._offDrawToolEvents(),this._offGeometryEvents(),this._resetGeosSet(),delete this._mousemove,delete this._mousedown,delete this._mouseup,this._mousemoveLayer&&this._mousemoveLayer.hide(),this},Ne.prototype.isEnable=function(){return this._isEnable},Ne.prototype.toggleEnable=function(){return this._isEnable?this.disable():this.enable()},Ne.prototype.remove=function(){this.disable();var t=map.getLayer(this._layerName);t&&t.remove(),delete this.geometry,delete this.geometryCoords,delete this._geosSetPoint,delete this._geosSetLine,delete this._mousemoveLayer,delete this._assistLayers},Ne.prototype.setMode=function(t){return this._updateModeType(t),this._updateGeosSet(),this},Ne.prototype.getMode=function(){return this._mode},Ne.prototype.setDistance=function(t){return this._updateDistance(t),this._updateGeosSet(),this},Ne.prototype.getDistance=function(){return this._distance},Ne.prototype.needCtrl=function(t){return this._updateNeedCtrl(t),this},Ne.prototype.setAssistGeosLayer=function(t){var r,n;return t?(r=this._map,t instanceof Array||(t=[t]),n=this.adsorblayer.getId(),0<(t=t.reduce(function(t,e){return e!==n&&r.getLayer(e)instanceof s.VectorLayer?[].concat(t,[e]):t},[])).length&&(this._assistLayers=t)):this._assistLayers=void 0,this._updateGeosSet(),this},Ne.prototype._updateModeType=function(t){this._mode=t||this.options.mode||Ie.mode},Ne.prototype._updateDistance=function(t){t=t||this.options.distance||Ie.distance,this._distance=Math.max(t,1)},Ne.prototype._updateNeedCtrl=function(t){t=void 0!==t?t:this.options.needCtrl,this._needCtrl=t=void 0!==t?t:Ie.needCtrl},Ne.prototype._addTo=function(t){return t.getLayer(this._layerName)&&this.remove(),this._mousemoveLayer=new s.VectorLayer(this._layerName).addTo(t).bringToFront(),this._map=t,this._resetGeosSet(),this},Ne.prototype._updateGeosSet=function(){var e=this,t=this._getGeosSet(),r="auto"===this._mode,n="vertux"===this._mode,o="border"===this._mode,i=[],a=[];t.forEach(function(t){(r||n)&&i.push.apply(i,e._parseToPoints(t)),(r||o)&&e._parseToLines(t).forEach(function(t){("Point"===t.geometry.type?i:a).push(t)})}),this._geosSetPoint=i,this._geosSetLine=a},Ne.prototype._getGeosSet=function(){var e=this.adsorblayer.getGeometries();return this._assistLayers&&this._assistLayers.forEach(function(t){return e.push.apply(e,map.getLayer(t).getGeometries())}),e},Ne.prototype._parseToPoints=function(t){var e=this;if(this._skipGeoSelf(t))return[];var r=[],t=t.getCoordinates();return t[0]instanceof Array?t.forEach(function(t){return r.push.apply(r,e._createMarkers(t))}):(t instanceof Array||(t=[t]),r.push.apply(r,this._createMarkers(t))),r},Ne.prototype._skipGeoSelf=function(t){if(this.geometry){var e=t.toGeoJSON().geometry.coordinates,t=this.geometry.toGeoJSON().geometry.coordinates;return H(e,t)}return!1},Ne.prototype._createMarkers=function(t){return Be(t).map(function(t){return new s.Marker(t,{properties:{}}).toGeoJSON()})},Ne.prototype._parseToLines=function(t){if(this._skipGeoSelf(t))return[];var e=[];return"Point"===t.type?e.push(t.setProperties({}).toGeoJSON()):e.push.apply(e,this._parsePolygonToLine(t)),e},Ne.prototype._parsePolygonToLine=function(e){var t,r=this,n=e.getCoordinates(),o=[];if(n instanceof Array)switch(e.type){case"MultiPolygon":n.forEach(function(t){return t.forEach(function(t){return o.push.apply(o,r._createLine(t,e))})});break;case"Polygon":n.forEach(function(t){return o.push.apply(o,r._createLine(t,e))});break;default:o.push.apply(o,this._createLine(n,e))}else"Polygon"===e.type&&((t=e.options).numberOfShellPoints=300,e.setOptions(t),n=e.getShell(),t.numberOfShellPoints=60,e.setOptions(t),o.push.apply(o,this._createMarkers(n)));return o},Ne.prototype._createLine=function(t,e){for(var r=[],n=0;n<t.length-1;n++){var o=[t[n],t[n+1]],o=new s.LineString(o,{properties:{obj:e}}).toGeoJSON();r.push(o)}return r},Ne.prototype._resetGeosSet=function(){this._geosSetPoint=[],this._geosSetLine=[]},Ne.prototype._registerMapEvents=function(){var t,e=this;this._mousemove||(t=this._map,this._mousemove=function(t){return e._mousemoveEvents(t)},this._mousedown=function(){e.drawTool&&(e._needFindGeometry=!1),e.geometry&&(e._needFindGeometry=!0)},this._mouseup=function(){e.drawTool&&(e._needFindGeometry=!0),e.geometry&&(e._needFindGeometry=!1)},t.on("mousemove touchstart",this._mousemove,this),t.on("mousedown",this._mousedown,this),t.on("mouseup",this._mouseup,this))},Ne.prototype._offMapEvents=function(){var t=this._map;this._mousemove&&t.off("mousemove touchstart",this._mousemove,this),this._mousedown&&t.off("mousedown",this._mousedown,this),this._mouseup&&t.off("mouseup",this._mouseup,this)},Ne.prototype._mousemoveEvents=function(t){var e=t.coordinate,t=t.domEvent;this._needDeal=!0,this._mousePoint=e,this._marker?this._marker.setCoordinates(e):this._marker=new s.Marker(e,{symbol:{}}).addTo(this._mousemoveLayer),this._updateAdsorbPoint(e),this._needCtrl===t.ctrlKey&&!this._hasAddVertux||(this.adsorbPoint=null)},Ne.prototype._updateAdsorbPoint=function(t){var e;this._needFindGeometry&&(e=this._findGeometry(t),this.adsorbPoint=e&&0<e.features.length?this._getAdsorbPoint(e):null,this.adsorbPoint&&(e=(t=this.adsorbPoint).x,t=t.y,this._marker.setCoordinates([e,t])))},Ne.prototype._findGeometry=function(t){if(!this._geosSetPoint&&!this._geosSetLine)return null;var e,r=[];return this._geosSetPoint&&(e=this._findAvailGeos(this._geosSetPoint,t),r.push.apply(r,e)),this._geosSetLine&&(t=this._findAvailGeos(this._geosSetLine,t),r.push.apply(r,t)),{type:"FeatureCollection",features:r}},Ne.prototype._findAvailGeos=function(t,e){this.tree.clear(),this.tree.load({type:"FeatureCollection",features:t});e=this._createInspectExtent(e);return this.tree.search(e).features},Ne.prototype._createInspectExtent=function(t){var e=Math.max(parseInt(this._distance,0),1),e=this._map.pixelToDistance(0,e);return new s.Circle(t,e,{properties:{}}).toGeoJSON()},Ne.prototype._getAdsorbPoint=function(t){t=this._findNearestFeatures(t.features);if(!t)return null;var e=t.geoObject,t=e.geometry,r=t.coordinates,t=t.type,n=r[0];switch(t){case"Point":return{x:n,y:r[1]};case"LineString":var o=this._setEquation(e),i=o.A,a=o.B,s=this._mousePoint,u=s.x,s=s.y;if(0===i)return{x:u,y:n[1]};if(i===1/0)return{x:n[0],y:s};i=this._setVertiEquation(a/i);return this._solveEquation(o,i);default:return null}},Ne.prototype._findNearestFeatures=function(t){t=this._setDistance(t);if(0===t.length)return null;var r;return t.sort((r="distance",function(t,e){return e[r]<t[r]}))[0]},Ne.prototype._setDistance=function(t){var o=this,i=-1===t.findIndex(function(t){return"Point"===t.geometry.type});return t.reduce(function(t,e,r){var n=void 0;switch(e.geometry.type){case"Point":n=o._distToPoint(e);break;case"LineString":i&&(n=o._distToPolyline(e))}return t=void 0!==n?[].concat(t,[{geoObject:e,distance:n}]):t},[])},Ne.prototype._distToPoint=function(t){var e=this._mousePoint,e=[e.x,e.y],t=t.geometry.coordinates;return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},Ne.prototype._distToPolyline=function(t){var e=this._mousePoint,r=e.x,n=e.y,o=this._setEquation(t),e=o.A,t=o.B,o=o.C;return Math.abs((e*r+t*n+o)/Math.sqrt(Math.pow(e,2)+Math.pow(t,2)))},Ne.prototype._setEquation=function(t){var e=t.geometry.coordinates,r=e[0],n=e[1],t=r[0],e=r[1],r=n[0],r=(e-n[1])/(t-r);return{A:r=r===-1/0?-r:r,B:-1,C:e-r*t}},Ne.prototype._setVertiEquation=function(t){var e=this._mousePoint,r=e.x;return{A:t,B:-1,C:e.y-t*r}},Ne.prototype._solveEquation=function(t,e){var r=t.A,n=t.B,o=t.C,i=e.A,t=e.B,e=e.C;return{x:(n*e-o*t)/(r*t-i*n),y:(r*e-i*o)/(n*i-t*r)}},Ne.prototype._registerDrawToolEvents=function(){var t=this.drawTool;t.on("drawstart",this._resetCoordsAndPoint,this),t.on("mousemove",this._resetCoordinates,this),t.on("drawvertex",this._resetCoordsAndPoint,this),t.on("drawend",this._resetCoordinates,this)},Ne.prototype._offDrawToolEvents=function(){var t;this.drawTool&&((t=this.drawTool).off("drawstart",this._resetCoordsAndPoint,this),t.off("mousemove",this._resetCoordinates,this),t.off("drawvertex",this._resetCoordsAndPoint,this),t.off("drawend",this._resetCoordinates,this))},Ne.prototype._registerGeometryEvents=function(){var t=this.geometry;t.on("shapechange",this._setEditCoordinates,this),t.on("editrecord",this._upGeoCoords,this)},Ne.prototype._offGeometryEvents=function(){var t;this.geometry&&((t=this.geometry).off("shapechange",this._setEditCoordinates,this),t.off("editrecord",this._upGeoCoords,this))},Ne.prototype._resetCoordsAndPoint=function(t){this._resetCoordinates(t),this._resetClickPoint(t)},Ne.prototype._resetCoordinates=function(t){var e,r,n,o,i;this.adsorbPoint&&(r=(n=t.target).options,o=n._geometry,e=r.mode,t=(i=this.adsorbPoint).x,n=i.y,(r=o)instanceof s.Geometry&&((i=r.getCoordinates())instanceof Array?("Rectangle"===e?0<i[0].length&&(i[0][1].x=t,i[0][2].x=t,i[0][2].y=n,i[0][3].y=n):(o=i.length)&&(i[o-1].x=t,i[o-1].y=n),r.setCoordinates(i)):"Circle"===e&&(i=this._map.getProjection().measureLength([i,this.adsorbPoint]),r.setRadius(i)._updateCache())))},Ne.prototype._resetClickPoint=function(t){var e,r,n;!this.adsorbPoint||((e=t.target._clickCoords)instanceof s.Coordinate||e instanceof Array)&&(r=this._map.coordToPoint(this.adsorbPoint),t=(n=this._map._pointToPrj(r)).x,r=n.y,(n=e.length)?(e[n-1].x=t,e[n-1].y=r):(e.x=t,e.y=r))},Ne.prototype._setEditCoordinates=function(t){var e,r,n,o,i,a;this.adsorbPoint&&this._needDeal&&"MultiPolygon"!==this.geometry.type&&(e=t.target,r=(o=this.adsorbPoint).x,n=o.y,this.geometryCoords instanceof Array?(t=this.geometryCoords[0],je(t,this.adsorbPoint)||((o=(a=e.getCoordinates())[0])instanceof Array?0===(t=Yt(o,t,H)).length?this._hasAddVertux=!0:(t=Nt(o,t[0]),i=o.length,a[0][t].x=r,a[0][t].y=n,0===t&&(a[0][i-1].x=r,a[0][i-1].y=n)):(i=Yt(a,this.geometryCoords,H)[0],a[i=Nt(a,i)].x=r,a[i].y=n),this._needDeal=!1,this._hasAddVertux||(e.setCoordinates(a),this._upGeoCoords({target:e})))):this.geometry instanceof s.Circle&&(this._needDeal=!1,a=this.geometryCoords,a=this._map.getProjection().measureLength([a,this.adsorbPoint]),e.setRadius(a)))},Ne.prototype._upGeoCoords=function(t){t=t.target;this.geometryCoords=t.getCoordinates(),this._hasAddVertux=!1},Ne);function Ne(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Ne);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,Ye.call(this,t));return t.tree=K(),t._layerName=s.INTERNAL_LAYER_PREFIX+"_Autoadsorb",t._isEnable=!1,t._updateModeType(),t._updateDistance(),t._updateNeedCtrl(),t}q.mergeOptions(Ie),t.Autoadsorb=q,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.autoadsorb v0.2.0, requires maptalks@>=0.47.0.")});